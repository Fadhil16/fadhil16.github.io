<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembelajaran SQL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
        }
        header {
            background: #333;
            color: #fff;
            padding-top: 30px;
            min-height: 70px;
            border-bottom: #77d1f5 3px solid;
        }
        header a, footer a {
            color: #fff;
            text-decoration: none;
            text-transform: uppercase;
            font-size: 16px;
        }
        footer {
            background: #333;
            color: #fff;
            text-align: center;
            padding: 10px 0;
            margin-top: 20px;
        }
        .main {
            padding: 20px;
            background: #fff;
            margin-top: 20px;
            border-radius: 8px;
        }
        code {
            background: #eee;
            padding: 2px 5px;
            border-radius: 4px;
            display: block;
            margin: 10px 0;
        }
        .sql-code {
            background: #f9f9f9;
            border-left: 4px solid #77d1f5;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Pembelajaran SQL</h1>
        </div>
    </header>

    <div class="container main">
        <h2>Query Dasar</h2>
        <p>Query berikut digunakan untuk menampilkan semua barang berdasarkan kategori:</p>
        <div class="sql-code">
            <code>
                SELECT * FROM barang WHERE kategori = 'elektronik';<br>
                SELECT * FROM barang WHERE kategori = 'non elektronik';
            </code>
        </div>

        <h2>Join dan Menghitung Total Harga</h2>
        <p>Query berikut digunakan untuk menampilkan detail pesanan beserta total harga:</p>
        <div class="sql-code">
            <code>
                SELECT pelanggan.id_pelanggan, pelanggan.nm_pelanggan, barang.id_barang, barang.nm_barang, barang.harga, pesanan.jml_pesanan, barang.harga * pesanan.jml_pesanan as Total_Harga<br>
                FROM pesanan<br>
                INNER JOIN pelanggan ON pesanan.id_pelanggan = pelanggan.id_pelanggan<br>
                INNER JOIN barang ON pesanan.id_barang = barang.id_barang;
            </code>
        </div>
        <p><strong>Penjelasan:</strong> Query ini menggunakan <code>INNER JOIN</code> untuk menggabungkan data dari tabel <code>pelanggan</code> dan <code>barang</code> berdasarkan tabel <code>pesanan</code>. Ini memungkinkan kita untuk melihat detail lengkap dari setiap pesanan, termasuk informasi pelanggan dan barang yang dipesan, serta menghitung total harga dari pesanan tersebut.</p>

        <h2>Membuat View</h2>
        <p>Query berikut digunakan untuk membuat view laporan penjualan:</p>
        <div class="sql-code">
            <code>
                CREATE VIEW vwLaporanPenjualan AS<br>
                SELECT pelanggan.id_pelanggan, pelanggan.nm_pelanggan, barang.id_barang, barang.nm_barang, barang.harga, pesanan.jml_pesanan, barang.harga * pesanan.jml_pesanan as Total_Harga<br>
                FROM pesanan<br>
                INNER JOIN pelanggan ON pesanan.id_pelanggan = pelanggan.id_pelanggan<br>
                INNER JOIN barang ON pesanan.id_barang = barang.id_barang;
            </code>
        </div>
        <p><strong>Penjelasan:</strong> View <code>vwLaporanPenjualan</code> dibuat untuk menyimpan query yang kompleks agar lebih mudah diakses dan digunakan kembali. Dengan membuat view ini, kita dapat menampilkan data laporan penjualan dengan mudah menggunakan <code>SELECT * FROM vwLaporanPenjualan</code>.</p>
        <p>Untuk menampilkan data dari view:</p>
        <div class="sql-code">
            <code>
                SELECT * FROM vwLaporanPenjualan;
            </code>
        </div>

        <h2>Membuat Stored Procedure</h2>
        <p>Query berikut digunakan untuk membuat stored procedure yang menampilkan detail barang berdasarkan ID:</p>
        <div class="sql-code">
            <code>
                CREATE PROCEDURE sp_TampilBarang @id_barang INT AS<br>
                SELECT nm_barang, harga, stok FROM barang<br>
                WHERE id_barang = @id_barang;<br>
                <br>
                EXEC sp_TampilBarang @id_barang = 2001;
            </code>
        </div>
        <p><strong>Penjelasan:</strong> Stored procedure <code>sp_TampilBarang</code> dibuat untuk menampilkan detail barang berdasarkan parameter <code>@id_barang</code>. Parameter ini memungkinkan kita untuk menyesuaikan query dengan ID barang yang berbeda setiap kali stored procedure dijalankan.</p>

        <h2>Membuat Fungsi</h2>
        <p>Query berikut digunakan untuk membuat fungsi yang menghitung total harga:</p>
        <div class="sql-code">
            <code>
                CREATE FUNCTION fn_HitungTotalHarga (@id_barang INT, @jumlah INT)<br>
                RETURNS INT<br>
                AS<br>
                BEGIN<br>
                    DECLARE @harga INT;<br>
                    <br>
                    SELECT @harga = harga FROM barang<br>
                    WHERE id_barang = @id_barang;<br>
                    <br>
                    RETURN @harga * @jumlah;<br>
                END;<br>
                <br>
                SELECT dbo.fn_HitungTotalHarga(2001, 4);
            </code>
        </div>
        <p><strong>Penjelasan:</strong> Fungsi <code>fn_HitungTotalHarga</code> dibuat untuk menghitung total harga berdasarkan ID barang dan jumlah yang diberikan sebagai parameter. Fungsi ini memudahkan dalam melakukan perhitungan yang berulang tanpa harus menulis ulang query yang sama.</p>

        <h2>Membuat Trigger</h2>
        <p>Query berikut digunakan untuk membuat trigger yang mengupdate status barang setelah ada pesanan:</p>
        <div class="sql-code">
            <code>
                CREATE TRIGGER tr_UpdateStatusBarang<br>
                ON pesanan<br>
                AFTER INSERT<br>
                AS<br>
                BEGIN<br>
                    UPDATE barang<br>
                    SET barang.stok = barang.stok - inserted.jml_pesanan<br>
                    FROM barang<br>
                    INNER JOIN inserted ON barang.id_barang = inserted.id_barang;<br>
                    <br>
                    UPDATE barang<br>
                    SET barang.status = 'tidak tersedia'<br>
                    WHERE barang.stok <= 0;<br>
                END;<br>
                <br>
                INSERT INTO pesanan VALUES('03-12-2024', 7, 71200000, 'diproses', 'dibayar', 'dikirim', 1001, 2001);<br>
                INSERT INTO pesanan VALUES('04-12-2024', 3, 31200000, 'diproses', 'dibayar', 'dikirim', 1001, 2001);
            </code>
        </div>
        <p><strong>Penjelasan:</strong> Trigger <code>tr_UpdateStatusBarang</code> dibuat untuk secara otomatis mengupdate stok dan status barang setelah ada pesanan baru yang dimasukkan. Trigger ini dijalankan setelah insert pada tabel <code>pesanan</code>, dan memastikan bahwa stok barang dikurangi sesuai dengan jumlah pesanan dan mengubah status barang menjadi 'tidak tersedia' jika stok habis.</p>

        <h2>Menghubungkan ke Database dengan PHP</h2>
        <p>Kode berikut digunakan untuk menghubungkan ke sebuah server database menggunakan PHP:</p>
        <div class="sql-code">
            <code>
                &lt;?php<br>
                <br>
                $host     = "NITRO";<br>
                $connInfo = array( "Database"=>"dbElektronik", "UID"=>"root", "PWD"=>"");<br>
                $conn     = sqlsrv_connect( $host, $connInfo);<br>
                <br>
                if( $conn ) {<br>
                   echo "Koneksi berhasil.<br />";<br>
                }else{<br>
                   echo "Koneksi Gagal";<br>
                   die( print_r( sqlsrv_errors(), true));<br>
                }<br>
                ?&gt;
            </code>
        </div>
        <p><strong>Penjelasan:</strong> Kode PHP di atas digunakan untuk menghubungkan ke server database <code>NITRO</code> dengan menggunakan kredensial yang diberikan. Jika koneksi berhasil, akan menampilkan pesan "Koneksi berhasil". Jika gagal, akan menampilkan pesan kesalahan dan menghentikan eksekusi script.</p>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 Pembelajaran SQL. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
